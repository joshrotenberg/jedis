
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../breaking-5/">
      
      
        <link rel="next" href="../jedis-maven/">
      
      
      <link rel="icon" href="../assets/images/favicon-16x16.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Failover with Jedis - Jedis</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#failover-with-jedis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Jedis" class="md-header__button md-logo" aria-label="Jedis" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jedis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Failover with Jedis
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/redis/jedis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Jedis" class="md-nav__button md-logo" aria-label="Jedis" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    Jedis
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/redis/jedis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3to4-primitives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3to4 primitives
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3to4-zset-list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3to4 zset list
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3to4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jedis 4 Breaking Changes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../breaking-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jedis 5 Breaking Changes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Failover with Jedis
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Failover with Jedis
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retry-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Retry configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit breaker configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Fallback configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failover-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Failover callbacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failing-back" class="md-nav__link">
    <span class="md-ellipsis">
      Failing back
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failback-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Failback scenario
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failback-behavior-and-cluster-selection-api" class="md-nav__link">
    <span class="md-ellipsis">
      Failback behavior and cluster selection API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failback behavior and cluster selection API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fail-back-using-the-cluster-selection-api" class="md-nav__link">
    <span class="md-ellipsis">
      Fail back using the cluster selection API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fail-back-by-restarting-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Fail back by restarting the application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../jedis-maven/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jedis maven
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../redisearch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RediSearch Jedis Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../redisjson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RedisJSON Jedis Quick Start
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retry-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Retry configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit breaker configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Fallback configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failover-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Failover callbacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failing-back" class="md-nav__link">
    <span class="md-ellipsis">
      Failing back
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failback-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Failback scenario
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failback-behavior-and-cluster-selection-api" class="md-nav__link">
    <span class="md-ellipsis">
      Failback behavior and cluster selection API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failback behavior and cluster selection API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fail-back-using-the-cluster-selection-api" class="md-nav__link">
    <span class="md-ellipsis">
      Fail back using the cluster selection API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fail-back-by-restarting-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Fail back by restarting the application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="failover-with-jedis">Failover with Jedis</h1>
<p>Jedis supports failover for your Redis deployments. This is useful when:
1. You have more than one Redis deployment. This might include two independent Redis servers or two or more Redis databases replicated across multiple <a href="https://docs.redis.com/latest/rs/databases/active-active/">active-active Redis Enterprise</a> clusters.
2. You want your application to connect to and use one deployment at a time.
3. You want your application to fail over to the next available deployment if the current deployment becomes unavailable.</p>
<p>Jedis will fail over to a subsequent Redis deployment after reaching a configurable failure threshold.
This failure threshold is implemented using a <a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern">circuit breaker pattern</a>.</p>
<p>You can also configure Jedis to retry failed calls to Redis.
Once a maximum number of retries have been exhausted, the circuit breaker will record a failure.
When the circuit breaker reaches its failure threshold, a failover will be triggered on the subsequent operation.</p>
<p>The remainder of this guide describes:</p>
<ul>
<li>A basic failover configuration</li>
<li>Supported retry and circuit breaker settings</li>
<li>Failback and the cluster selection API</li>
</ul>
<p>We recommend that you read this guide carefully and understand the configuration settings before enabling Jedis failover
in production.</p>
<h2 id="basic-usage">Basic usage</h2>
<p>To configure Jedis for failover, you specify an ordered list of Redis databases.
By default, Jedis will connect to the first Redis database in the list. If the first database becomes unavailable,
Jedis will attempt to connect to the next database in the list, and so on.</p>
<p>Suppose you run two Redis deployments.
We'll call them <code>redis-east</code> and <code>redis-west</code>.
You want your application to first connect to <code>redis-east</code>.
If <code>redis-east</code> becomes unavailable, you want your application to connect to <code>redis-west</code>.</p>
<p>Let's look at one way of configuring Jedis for this scenario.</p>
<p>First, create an array of <code>ClusterConfig</code> objects, one for each Redis database.</p>
<pre><code class="language-java">JedisClientConfig config = DefaultJedisClientConfig.builder().user(&quot;cache&quot;).password(&quot;secret&quot;).build();

ClusterConfig[] clientConfigs = new ClusterConfig[2];
clientConfigs[0] = new ClusterConfig(new HostAndPort(&quot;redis-east.example.com&quot;, 14000), config);
clientConfigs[1] = new ClusterConfig(new HostAndPort(&quot;redis-west.example.com&quot;, 14000), config);
</code></pre>
<p>The configuration above represents your two Redis deployments: <code>redis-east</code> and <code>redis-west</code>.
You'll use this array of configuration objects to create a connection provider that supports failover.</p>
<p>Use the <code>MultiClusterClientConfig</code> builder to set your preferred retry and failover configuration, passing in the client configs you just created.
Then build a <code>MultiClusterPooledConnectionProvider</code>.</p>
<pre><code class="language-java">MultiClusterClientConfig.Builder builder = new MultiClusterClientConfig.Builder(clientConfigs);
builder.circuitBreakerSlidingWindowSize(10);
builder.circuitBreakerSlidingWindowMinCalls(1);
builder.circuitBreakerFailureRateThreshold(50.0f);

MultiClusterPooledConnectionProvider provider = new MultiClusterPooledConnectionProvider(builder.build());
</code></pre>
<p>Internally, the connection provider uses a <a href="https://resilience4j.readme.io/docs/circuitbreaker">highly configurable circuit breaker and retry implementation</a> to determine when to fail over.
In the configuration here, we've set a sliding window size of 10 and a failure rate threshold of 50%.
This means that a failover will be triggered if 5 out of any 10 calls to Redis fail.</p>
<p>Once you've configured and created a <code>MultiClusterPooledConnectionProvider</code>, instantiate a <code>UnifiedJedis</code> instance for your application, passing in the provider you just created:</p>
<pre><code class="language-java">UnifiedJedis jedis = new UnifiedJedis(provider);
</code></pre>
<p>You can now use this <code>UnifiedJedis</code> instance, and the connection management and failover will be handled transparently.</p>
<h2 id="configuration-options">Configuration options</h2>
<p>Under the hood, Jedis' failover support relies on <a href="https://resilience4j.readme.io/docs/getting-started">resilience4j</a>,
a fault-tolerance library that implements <a href="https://resilience4j.readme.io/docs/retry">retry</a> and <a href="https://resilience4j.readme.io/docs/circuitbreaker">circuit breakers</a>.</p>
<p>Once you configure Jedis for failover using the <code>MultiClusterPooledConnectionProvider</code>, each call to Redis is decorated with a resilience4j retry and circuit breaker.</p>
<p>By default, any call that throws a <code>JedisConnectionException</code> will be retried up to 3 times.
If the call continues to fail after the maximum number of retry attempts, then the circuit breaker will record a failure.</p>
<p>The circuit breaker maintains a record of failures in a sliding window data structure.
If the failure rate reaches a configured threshold (e.g., when 50% of the last 10 calls have failed),
then the circuit breaker's state transitions from <code>CLOSED</code> to <code>OPEN</code>.
When this occurs, Jedis will attempt to connect to the next Redis database in its client configuration list.</p>
<p>The supported retry and circuit breaker settings, and their default values, are described below.
You can configure any of these settings using the <code>MultiClusterClientConfig.Builder</code> builder.
Refer the basic usage above for an example of this.</p>
<h3 id="retry-configuration">Retry configuration</h3>
<p>Jedis uses the following retry settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Max retry attempts</td>
<td>3</td>
<td>Maximum number of retry attempts (including the initial call)</td>
</tr>
<tr>
<td>Retry wait duration</td>
<td>500 ms</td>
<td>Number of milliseconds to wait between retry attempts</td>
</tr>
<tr>
<td>Wait duration backoff multiplier</td>
<td>2</td>
<td>Exponential backoff factor multiplied against wait duration between retries. For example, with a wait duration of 1 second and a multiplier of 2, the retries would occur after 1s, 2s, 4s, 8s, 16s, and so on.</td>
</tr>
<tr>
<td>Retry included exception list</td>
<td>[JedisConnectionException]</td>
<td>A list of Throwable classes that count as failures and should be retried.</td>
</tr>
<tr>
<td>Retry ignored exception list</td>
<td>null</td>
<td>A list of Throwable classes to explicitly ignore for the purposes of retry.</td>
</tr>
</tbody>
</table>
<p>To disable retry, set <code>maxRetryAttempts</code> to 1.</p>
<h3 id="circuit-breaker-configuration">Circuit breaker configuration</h3>
<p>Jedis uses the following circuit breaker settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sliding window type</td>
<td><code>COUNT_BASED</code></td>
<td>The type of sliding window used to record the outcome of calls. Options are <code>COUNT_BASED</code> and <code>TIME_BASED</code>.</td>
</tr>
<tr>
<td>Sliding window size</td>
<td>100</td>
<td>The size of the sliding window. Units depend on sliding window type. When <code>COUNT_BASED</code>, the size represents number of calls. When <code>TIME_BASED</code>, the size represents seconds.</td>
</tr>
<tr>
<td>Sliding window min calls</td>
<td>100</td>
<td>Minimum number of calls required (per sliding window period) before the CircuitBreaker will start calculating the error rate or slow call rate.</td>
</tr>
<tr>
<td>Failure rate threshold</td>
<td><code>50.0f</code></td>
<td>Percentage of calls within the sliding window that must fail before the circuit breaker transitions to the <code>OPEN</code> state.</td>
</tr>
<tr>
<td>Slow call duration threshold</td>
<td>60000 ms</td>
<td>Duration threshold above which calls are classified as slow and added to the sliding window.</td>
</tr>
<tr>
<td>Slow call rate threshold</td>
<td><code>100.0f</code></td>
<td>Percentage of calls within the sliding window that exceed the slow call duration threshold before circuit breaker transitions to the <code>OPEN</code> state.</td>
</tr>
<tr>
<td>Circuit breaker included exception list</td>
<td>[JedisConnectionException]</td>
<td>A list of Throwable classes that count as failures and add to the failure rate.</td>
</tr>
<tr>
<td>Circuit breaker ignored exception list</td>
<td>null</td>
<td>A list of Throwable classes to explicitly ignore for failure rate calculations.</td>
</tr>
</tbody>
</table>
<h3 id="fallback-configuration">Fallback configuration</h3>
<p>Jedis uses the following fallback settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fallback exception list</td>
<td>[CallNotPermittedException, JedisConnectionException]</td>
<td>A list of Throwable classes that trigger fallback.</td>
</tr>
</tbody>
</table>
<h3 id="failover-callbacks">Failover callbacks</h3>
<p>In the event that Jedis fails over, you may wish to take some action. This might include logging a warning, recording
a metric, or externally persisting the cluster connection state, to name just a few examples. For this reason,
<code>MultiPooledConnectionProvider</code> lets you register a custom callback that will be called whenever Jedis
fails over to a new cluster.</p>
<p>To use this feature, you'll need to design a class that implements <code>java.util.function.Consumer</code>.
This class must implement the <code>accept</code> method, as you can see below.</p>
<pre><code class="language-java">import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.function.Consumer;

public class FailoverReporter implements Consumer&lt;String&gt; {

    @Override
    public void accept(String clusterName) {
        Logger logger = LoggerFactory.getLogger(FailoverReporter.class);
        logger.warn(&quot;Jedis failover to cluster: &quot; + clusterName);
    }
}
</code></pre>
<p>You can then pass an instance of this class to your <code>MultiPooledConnectionProvider</code>.</p>
<pre><code>FailoverReporter reporter = new FailoverReporter();
provider.setClusterFailoverPostProcessor(reporter);
</code></pre>
<p>The provider will call your <code>accept</code> whenever a faoliver occurs.</p>
<h2 id="failing-back">Failing back</h2>
<p>We believe that failback should not be automatic.
If Jedis fails over to a new cluster, Jedis will <em>not</em> automatically fail back to the cluster that it was previously connected to.
This design prevents a scenario in which Jedis fails back to a cluster that may not be entirely healthy yet.</p>
<p>That said, we do provide an API that you can use to implement automated failback when this is appropriate for your application.</p>
<h2 id="failback-scenario">Failback scenario</h2>
<p>When a failover is triggered, Jedis will attempt to connect to the next Redis server in the list of server configurations
you provide at setup.</p>
<p>For example, recall the <code>redis-east</code> and <code>redis-west</code> deployments from the basic usage example above.
Jedis will attempt to connect to <code>redis-east</code> first.
If <code>redis-east</code> becomes unavailable (and the circuit breaker transitions), then Jedis will attempt to use <code>redis-west</code>.</p>
<p>Now suppose that <code>redis-east</code> eventually comes back online.
You will likely want to fail your application back to <code>redis-east</code>.
However, Jedis will not fail back to <code>redis-east</code> automatically.</p>
<p>In this case, we recommend that you first ensure that your <code>redis-east</code> deployment is healthy before you fail back your application.</p>
<h2 id="failback-behavior-and-cluster-selection-api">Failback behavior and cluster selection API</h2>
<p>Once you've determined that it's safe to fail back to a previously-unavailable cluster,
you need to decide how to trigger the failback. There are two ways to accomplish this:</p>
<ol>
<li>Use the cluster selection API</li>
<li>Restart your application</li>
</ol>
<h3 id="fail-back-using-the-cluster-selection-api">Fail back using the cluster selection API</h3>
<p><code>MultiClusterPooledConnectionProvider</code> exposes a method that you can use to manually select which cluster Jedis should use.
To select a different cluster to use, pass the cluster's numeric index to <code>setActiveMultiClusterIndex()</code>.</p>
<p>The cluster's index is a 1-based index derived from its position in the client configuration.
For example, suppose you configure Jedis with the following client configs:</p>
<pre><code>ClusterConfig[] clientConfigs = new ClusterConfig[2];
clientConfigs[0] = new ClusterConfig(new HostAndPort(&quot;redis-east.example.com&quot;, 14000), config);
clientConfigs[1] = new ClusterConfig(new HostAndPort(&quot;redis-west.example.com&quot;, 14000), config);
</code></pre>
<p>In this case, <code>redis-east</code> will have an index of <code>1</code>, and <code>redis-west</code> will have an index of <code>2</code>.
To select and fail back to <code>redis-east</code>, you would call the function like so:</p>
<pre><code>provider.setActiveMultiClusterIndex(1);
</code></pre>
<p>This method is thread-safe.</p>
<p>If you decide to implement manual failback, you will need a way for external systems to trigger this method in your
application. For example, if your application exposes a REST API, you might consider creating a REST endpoint
to call <code>setActiveMultiClusterIndex</code> and fail back the application.</p>
<h3 id="fail-back-by-restarting-the-application">Fail back by restarting the application</h3>
<p>When your application starts, Jedis will attempt to connect to each cluster in the order that the clusters appear
in your client configuration. It's important to understand this, especially in the case where Jedis has failed over.
If Jedis has failed over to a new cluster, then restarting the application may result in an inadvertent failback.
This can happen only if a failed cluster comes back online and the application subsequently restarts. </p>
<p>If you need to avoid this scenario, consider using a failover callback, as described above, to externally record
the name of the cluster that your application was most recently connected to. You can then check this state on startup
to ensure that you application only connects to the most recently used cluster. For assistance with this technique,
<a href="https://github.com/redis/jedis/discussions/new?category=q-a">start a discussion</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>